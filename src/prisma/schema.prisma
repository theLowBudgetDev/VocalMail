// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  name      String
  avatar    String
  contacts  Contact[] @relation("UserContacts")
  sent      Email[]   @relation("SentEmails")
  received  Email[]   @relation("ReceivedEmails")
  Contact   Contact[] @relation("ContactUser")
}

model Contact {
  id        String @id @default(cuid())
  ownerId   String
  contactId String
  owner     User   @relation("UserContacts", fields: [ownerId], references: [id], onDelete: Cascade)
  contact   User   @relation("ContactUser", fields: [contactId], references: [id], onDelete: Cascade)

  @@unique([ownerId, contactId])
}

model Email {
  id            String    @id @default(cuid())
  subject       String
  body          String
  sentAt        DateTime  @default(now())
  read          Boolean   @default(false)
  tag           String // "inbox", "sent", "archive"
  category      String // "urgent", "important", etc.
  priority      Int
  summary       String?
  suggestions   Json?
  
  senderId      String
  sender        User      @relation("SentEmails", fields: [senderId], references: [id], onDelete: Cascade)
  
  recipientId   String
  recipient     User      @relation("ReceivedEmails", fields: [recipientId], references: [id], onDelete: Cascade)
}
